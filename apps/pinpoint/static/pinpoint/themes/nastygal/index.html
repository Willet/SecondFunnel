{% load staticfiles %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7{% if product %} stl {% endif %}" lang="en"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8{% if product %} stl {% endif %}" lang="en"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9{% if product %} stl {% endif %}" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js{% if product %} stl {% endif %}" lang="en"> <!--<![endif]-->
<head>
    {% include "pinpoint/campaign_opengraph_tags.html" %}
    {% include "pinpoint/campaign_head.html" %}
    <!-- End Optimizer Tests -->
    <link rel="shortcut icon"
         href="http://assets.nastygal.com/assets/current/images/favicon/favicon-152.png" />
    <link rel="stylesheet"
          href="{% static 'pinpoint/themes/nastygal/nastygal.css' %}"/>
    <link rel="stylesheet"
          href="{% static 'pinpoint/themes/nastygal/bustle.css' %}"/>
    {% include "pinpoint/campaign_respond.html" %}
    <!-- Add Optimizer Tests here -->
    <script type="text/javascript">
        window.TRACKING_PIXELS = {
            'A': {
                'view': 'http://cm.gy/cej4',
                'click': 'http://cm.gy/umez'
            },
            'B': {
                'view': 'http://cm.gy/q3ay',
                'click': 'http://cm.gy/771t'
            }
        };
        window.ACTIVE_TEST = 'A';
        window.OPTIMIZER_TESTS = [];
        window.OPTIMIZER_TESTS.push({
            index: 7,
            test: 'custom',
            custom: function (cookie) {
                var tileTemplateId = 'image_preview_template',
                    tests = {{ tests|safe }};

                if (!(tests && tests.length)) {
                    tests = ["A", "B"];
                }

                cookie = cookie || _.sample(tests);
                window.ACTIVE_TEST = cookie;

                if (cookie !== "A") {  // A is base case
                    $('#' + tileTemplateId).html($('#' +
                        cookie.toLowerCase() + '_' + tileTemplateId).html());
                }

                return cookie;
            }
        });
    </script>
    {% if environment == 'production' %}
        <script type='text/javascript'>
            var interval = setInterval(function() {
                var test, bindFn;

                if (!window.ACTIVE_TEST) {
                    return;
                }

                // Because we need to bind some events before anything else, use this fn
                // http://stackoverflow.com/a/2641047
                $.fn.bindFirst = function(name, fn) {
                    // bind as you normally would
                    // don't want to miss out on any jQuery magic
                    this.on(name, fn);

                    // Thanks to a comment by @Martin, adding support for
                    // namespaced events too.
                    this.each(function() {
                        var handlers = $._data(this, 'events')[name.split('.')[0]];
                        // take out the handler we just inserted from the end
                        var handler = handlers.pop();
                        // move it at the beginning
                        handlers.splice(0, 0, handler);
                    });
                };

                bindFn = function() {
                    (new Image).src = window.TRACKING_PIXELS[test].click;
                }

                clearInterval(interval);
                test = window.ACTIVE_TEST;

                // Append click pixel
                if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    $('.tile').bindFirst('click', bindFn);
                } else {
                    // Why doesn't bindFirst work on desktop?
                    $('body').on('click', '.tile', bindFn);
                }


                // Append page view pixel
                (new Image).src = window.TRACKING_PIXELS[test].view;
            }, 1000);
        </script>
    {% endif %}
    <title>{{ page.name|default:"Nasty Gal" }}</title>
    <style type="text/css">
        /* out of necessity */
        .visible-xs.jumbotron { /* mobile hero */
            {% if mobile_hero_image %}
                background-image: url('{{ mobile_hero_image }}');
            {% else %}
                background-image: url('{{ desktop_hero_image }}');
            {% endif %}
        }
        .visible-md.jumbotron, .visible-lg.jumbotron, .visible-sm.jumbotron { /* desktop hero */
            {% if desktop_hero_image %}
                background-image: url('{{ desktop_hero_image }}');
            {% else %}
                background-image: url('{{ mobile_hero_image }}');
            {% endif %}
        }
    </style>
    <link rel="stylesheet" href="http://use.typekit.net/c/94f591/brandon-grotesque:n3:n4:n5,ff-tisa-web-pro:i4:n4:n7.Y2j:N:2,Y2l:N:2,Y2n:N:2,Vdl:N:2,Vdk:N:2,Vdp:N:2/d?3bb2a6e53c9684ffdc9a98f4135b2a62d7ad2c805d37e76a8d7c97eb987b54e58d04ed6ab887c8dfa6f3881c7a78798cce60e1f7fe603815063e972cd5ef309daec6daba7f17bf0bb1c6ce10afcb8c5ce12539ac6001934bed2551761a601610c0c378a58bd4a32325394d4e1fb9221b4222c793abc5da2f9d2e73cda923a06da08748eae613662161cf409ac9bc446b0e0e8767c350ffc85a6a758f95301480c4dd70ea0d09d8462ad77d830718925e342f13c8ce4de853981a7a0aa06603418b2c49ee5bb97c830133115a17a03566219f629b7ee837f9d77da030eaadbe257453f3387d">
</head>
<body>

    <!-- bustle header begin -->
    <div id="bustle">
    <div id="ember743" class="hoverable ember-view header"><div class="container">
      <a id="ember746" class="ember-view logo active" href="http://www.bustle.com/">Bustle</a>
      <div id="ember749" class="ember-view loading-spinner site-loading hide"></div>
      <div class="main-menu">
        <ul class="main-navigation" role="navigation">
          <li><a id="ember750" class="ember-view main-nav-link nav-news" href="http://www.bustle.com/news"><span>News</span></a></li>
          <li><a id="ember759" class="ember-view main-nav-link nav-entertainment" href="http://www.bustle.com/entertainment"><span>Entertainment</span></a></li>
          <li><a id="ember766" class="ember-view main-nav-link nav-fashion-beauty" href="http://www.bustle.com/fashion-beauty"><span>Fashion &amp; Beauty</span></a></li>
          <li><a id="ember773" class="ember-view main-nav-link nav-lifestyle" href="http://www.bustle.com/lifestyle"><span>Lifestyle</span></a></li>
          <li><a id="ember780" class="ember-view main-nav-link nav-books" href="http://www.bustle.com/books"><span>Books</span></a></li>
        </ul>
        <script id="metamorph-1-start" type="text/x-placeholder"></script><script id="metamorph-1-end" type="text/x-placeholder"></script>
        <a class="main-search-btn" role="search" data-ember-action="1"><i class="icon-search"></i></a>
        <a id="ember793" class="ember-view menu-btn"><i class="icon-menu"></i></a>
        <div class="header-social-media">
          <a href="http://pinterest.com/bustledotcom/" title="Bustle on Pinterest" class="social-link social-link-pinterest"><i class="icon-pinterest-circle"></i></a>
          <a href="https://www.facebook.com/bustledotcom" title="Bustle on Facebook" class="social-link social-link-facebook"><i class="icon-facebook-circle"></i></a>
          <a href="https://twitter.com/bustle" title="Bustle on Twitter" class="social-link social-link-twitter"><i class="icon-twitter-circle"></i></a>

          <div class="header-social-media-popup">
            <iframe class="facebook-like-button" src="//www.facebook.com/plugins/like.php?href=https%3A%2F%2Ffacebook.com%2Fbustledotcom&amp;width&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;share=false&amp;height=21&amp;appId=132694503601208" scrolling="no" frameborder="0" allowtransparency="true"></iframe>
            <a class="pinterest-follow-button" href="http://www.pinterest.com/bustledotcom/" title="Follow Bustle on Pinterest" target="_blank"><i class="icon-pinterest-circle"></i>Follow</a>
            <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="http://platform.twitter.com/widgets/follow_button.1401325387.html#_=1401772767364&amp;id=twitter-widget-0&amp;lang=en&amp;screen_name=bustle&amp;show_count=false&amp;show_screen_name=false&amp;size=m" class="twitter-follow-button twitter-follow-button" title="Twitter Follow Button" data-twttr-rendered="true" style="width: 60px; height: 20px;"></iframe>
          </div>
        </div>
      </div>
    </div>
    </div>
    </div>
    <!-- bustle header end -->


    <div class='navbar'>
        <div class="container">
            <img alt="NastyGal" class="nastygal" src="{% static 'pinpoint/themes/nastygal/images/logo.png' %}" />
        </div>
    </div>

    {% include "pinpoint/campaign_body.html" %}

    <div>
        <!-- generic templates -->
        <script type="text/template" id="category_template">
            <span><%= obj.name %></span>
        </script>

        <script type="text/template" id="shopthelook_template">
            <div class='text-centered'>
                <div class='content-wrapper row'>
                    <div class='cell middle'>
                        <div class="gallery-main-image"></div>
                        <% if (obj.images.length > 1 && App.support.mobile()) { %>
                            <div class='gallery dots'></div>
                        <% } %>
                    </div>
                    <div class='cell middle info'>
                        <div class='title'></div>
                        <div class='price'></div>
                        <div class='buy'></div>
                        <% if (!App.support.mobile()) { %>
                            <div class="gallery"></div>
                            <div class="social-button-container">
                                <div class="social-buttons"></div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </script>

        <script type="text/template" id="product_tile_template">
            <div class="tap-indicator-target"></div>
            <img class="focus" src="<%= obj.image.url %>" alt="<%= caption %>" />
            <% if (App.option('debug', 0) > 1) { %>
                <span class="type"><%= obj['content-type'] %></span>
            <% } %>
            <div class="name"><%= obj.title || obj.name %></div>
        </script>

        <script type="text/template" id="image_tile_template">
            <div class="tap-indicator-target"></div>
            <div class='relative'>
                <img class="focus" src="<%= obj.image.url %>" alt="<%= obj.caption %>" />
            </div>
            <% if (App.option("debug", 0) > 1) { %>
                <span class="type"><%= obj["content-type"] %></span>
            <% } %>
        </script>

        <script type="text/template" id="youtube_tile_template">
            <div class="img-responsive thumbnail"
                 style="background-image: url('<%= obj.thumbnail || obj.image.url %>');">
              &nbsp;
              <img src="" alt="this img tag intentionally left blank" style="visibility:hidden"/>
            </div>
            <%= obj.caption || obj.name %>
            <div class="social-buttons"></div>
        </script>

        <script type="text/template" id="preview_container_template">
            <div class="fullscreen">
                <div class="content">
                    <span class="close">BACK TO BROWSING</span>
                    <div class="scrollable">
                        <div class="template target"></div>
                    </div>
                </div>
            </div>
            <div class="mask"></div>
        </script>

        <script type="text/template" id="tile_preview_template">
            <h2><span class="label label-info"><%= obj.template %>_preview_template</span> is missing.</h2>
            <p>You can define one in your template.</p>
            <ul>
                <% for (i in obj) { %>
                    <li><b><%= i %></b>: <%= obj[i] %></li>
                <% } %>
            </ul>
        </script>

        <script type="text/template" id="tap_indicator_template">
            +
            <div>
                <%= App.option('tapIndicatorText', 'tap to see more') %>
            </div>
        </script>

        <script type="text/template" id="facebook_social_button_template">
            <div class='button facebook'>
                <fb:like href="<%= url %>" width="25" layout="button"
                         show_faces="false"></fb:like>
            </div>
        </script>

        <script type="text/template" id="twitter_social_button_template">
            <% var desc = caption || description || name; %>
            <% var cleanDesc = desc.replace(/<(?:.|\n)*?>/gm, ''); %>
            <div class='button twitter'>
                <a href="//twitter.com/share?url=<%= url %>&text=<%= cleanDesc %>"
                   target="_blank">
                    <img src="{% static 'pinpoint/themes/nastygal/images/twitter.png' %}"/>
                </a>
            </div>
        </script>

        <script type="text/template" id="pinterest_social_button_template">
            <% var desc = caption || description || name; %>
            <% var cleanDesc = desc.replace(/<(?:.|\n)*?>/gm, ''); %>
            <div class='button pinterest'>
                <a data-pin-do="none" href="http://pinterest.com/pin/create/button/?url=<%= url %>&media=<%= image %>&description=<%= cleanDesc %>"
                   target="_blank"><img src="{% static 'pinpoint/themes/nastygal/images/pinterest.png' %}"/></a>
            </div>
        </script>

        <script type="text/template" id="tumblr_social_button_template">
            <% var desc = caption || description || name; %>
            <% var cleanDesc = desc.replace(/<(?:.|\n)*?>/gm, ''); %>
            <div class="button tumblr">
                <a href="http://www.tumblr.com/share/photo?source=<%= image %>&caption=<%= cleanDesc %>&click_thru=<%= url %>"
                     target='_blank'><img src="{% static 'pinpoint/themes/nastygal/images/tumblr.png' %}"/></a>
            </div>
        </script>

        <script type="text/template" id="product_price_template">
            <%- obj.price %>
        </script>

        <script type="text/template" id="product_title_template">
            <%- obj.title || obj.name %>
        </script>

        <script type="text/template" id="product_buy_template">
            <a class='button' href='<%= obj.url %>' target='_blank'>
                <img class="shop-icon" src="{% static 'pinpoint/themes/nastygal/images/shoppingbag.png' %}" />
                <div class="inline">
                    SHOP NOW
                </div>
            </a>
        </script>

        <script type="text/template" id="product_galleryMainImage_template">
            <div class="main-image-container">
                <% if (obj.images.length > 1) { %>
                    <div class="gallery-swipe-left"></div>
                    <div class="gallery-swipe-right"></div>
                <% } %>
                <div class="main-image">
                    <% for (var i = 0; i < obj.images.length; i++) { %>
                        <img class="image" src="<%- obj.images[i].url %>" />
                    <% } %>
                </div>
            </div>
        </script>

        <script type="text/template" id="product_preview_template">
            <div class="table">
                <div class='content-wrapper row'>
                    <div class='cell middle'>
                        <div class="gallery-main-image"></div>
                    </div>
                    <% if (obj.images.length > 1 && App.support.mobile()) { %>
                        <div class='cell'>
                            <div class='gallery dots'></div>
                        </div>
                    <% } %>
                    <div class='cell middle info'>
                        <div class='title'></div>
                        <div class='price'></div>
                        <div class='buy'></div>
                        <% if (!App.support.mobile()) { %>
                            <div class="gallery"></div>
                            <div class="social-button-container">
                                <div class="social-buttons"></div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </script>

        <script type="text/template" id="b_image_preview_template">
            <% if (obj['tagged-products'].length) { %>
                <% var product = obj['tagged-products'][0]; %>
                <div class="image-with-tagged-products">
                    <div class="table">
                        <div class="row">
                            <% if (obj['tagged-products'].length > 1 && obj.orientation !== 'landscape') { %>
                                <div class="cell desktop-only shop">
                                    <div class="stl-title">THE LOOK</div>
                                    <div class="stl-look">
                                        <% var  related = obj['tagged-products'] %>
                                        <% for (var i = 0; i < related.length; i++) { %>
                                            <div class="stl-item" data-index="<%- i %>">
                                                <img src="<%- related[i].images[0].url %>" />
                                                <div class="name">
                                                    <%- related[i].title || related[i].name %>
                                                </div>
                                            </div>
                                        <% } %>
                                    </div>
                                </div>
                            <% } %>
                            <div class="middle cell capped-width desktop-only">
                                <img src="<%= obj.image.url %>" alt="image" class="image"/>
                                <div class='caption'><%= (obj.title || obj.name || obj.caption || "") %></div>
                                <% if (obj['tagged-products'].length > 1 && obj.orientation === 'landscape') { %>
                                    <div class="landscape">
                                        <div class="stl-title">THE LOOK</div>
                                        <div class="stl-look">
                                            <% var  related = obj['tagged-products'] %>
                                            <% for (var i = 0; i < related.length; i++) { %>
                                                <div class="stl-item" data-index="<%- i %>">
                                                    <img src="<%- related[i].images[0].url %>" />
                                                    <div class="name">
                                                        <%- related[i].title || related[i].name %>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                            <div class="middle cell capped-width mobile-only">
                                <img src="<%= obj.image.url %>" alt="image"/>
                                <div class='caption'><%= (obj.title || obj.name || obj.caption || "") %></div>
                            </div>
                            <div class="middle cell info image<% if (obj.orientation === 'landscape') { %> landscape<% } %>">
                                <% if (!App.support.mobile()) { %>
                                    <div class='title'></div>
                                    <div class='price'></div>
                                    <div class='buy'></div>
                                <% } %>
                                <div class='gallery-main-image'></div>
                                <div class='gallery dots'></div>
                                <% if (App.support.mobile()) { %>
                                    <div class='price'></div>
                                    <div class='buy'></div>
                                <% } %>
                                <% if (obj['tagged-products'].length > 1 && App.support.mobile()) { %>
                                    <div class="landscape">
                                        <div class="stl-title">THE LOOK</div>
                                        <div class="stl-look">
                                            <% var  related = obj['tagged-products'] %>
                                            <% for (var i = 0; i < related.length; i++) { %>
                                                <div class="stl-item" data-index="<%- i %>">
                                                    <img src="<%- related[i].images[0].url %>" />
                                                    <div class="name">
                                                        <%- related[i].title || related[i].name %>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                <% } %>
                                <% if (!App.support.mobile()) { %>
                                    <div class="social-buttons"></div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <div class="image-without-tagged-products">
                    <div class="table">
                        <div class="row">
                            <div class="middle cell capped-width">
                                <img src="<%= obj.image.url %>" alt="image" class="main-image" />
                            </div>
                            <div class="middle cell">
                                <div class="info">
                                    <div class="title">
                                        Coming soon to Nasty Gal!
                                    </div>
                                    <a class='button' href='http://www.nastygal.com/lookbooks-swim-city' target='_blank'>
                                        <img class="shop-icon" src="{% static 'pinpoint/themes/nastygal/images/shoppingbag.png' %}" />
                                        <div class="inline">
                                            SHOP ON NASTY GAL
                                        </div>
                                    </a>
                                    <div class="social-buttons"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>
        </script>

        <script type="text/template" id="image_preview_template">
            <% if (obj['tagged-products'].length) { %>
                <% var product = obj['tagged-products'][0]; %>
                <div class="image-with-tagged-products">
                    <div class="table">
                        <div class="row">
                            <% if (obj['tagged-products'].length > 1 && obj.orientation !== 'landscape') { %>
                                <div class="cell desktop-only shop">
                                    <div class="stl-title">THE LOOK</div>
                                    <div class="stl-look">
                                        <% var  related = obj['tagged-products'] %>
                                        <% for (var i = 0; i < related.length; i++) { %>
                                            <div class="stl-item" data-index="<%- i %>">
                                                <img src="<%- related[i].images[0].url %>" />
                                                <div class="name">
                                                    <%- related[i].title || related[i].name %>
                                                </div>
                                            </div>
                                        <% } %>
                                    </div>
                                </div>
                            <% } %>
                            <div class="middle cell capped-width desktop-only">
                                <img src="<%= obj.image.url %>" alt="image" class="image"/>
                                <div class='caption'><%= (obj.title || obj.name || obj.caption || "") %></div>
                                <% if (obj['tagged-products'].length > 1 && obj.orientation === 'landscape') { %>
                                    <div class="landscape">
                                        <div class="stl-title">THE LOOK</div>
                                        <div class="stl-look">
                                            <% var  related = obj['tagged-products'] %>
                                            <% for (var i = 0; i < related.length; i++) { %>
                                                <div class="stl-item" data-index="<%- i %>">
                                                    <img src="<%- related[i].images[0].url %>" />
                                                    <div class="name">
                                                        <%- related[i].title || related[i].name %>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                            <div class="middle cell info<% if (obj.orientation === 'landscape') { %> landscape<% } %>">
                                <div class='title'></div>
                                <div class='price'></div>
                                <div class='buy'></div>
                                <div class='gallery-main-image'></div>
                                <div class='gallery dots'></div>
                                <% if (!App.support.mobile()) { %>
                                    <div class="social-buttons"></div>
                                <% } else if (obj['tagged-products'].length > 1) { %>
                                    <div class="more-info">
                                        MORE FROM THAT LOOK
                                        <img src="{% static 'pinpoint/themes/nastygal/images/down_arrow.png' %}" />
                                    </div>
                                <% } %>
                            </div>
                            <div class="middle cell capped-width mobile-only">
                                <img src="<%= obj.image.url %>" alt="image"/>
                                <div class='caption'><%= (obj.title || obj.name || obj.caption || "") %></div>
                                <% if (obj['tagged-products'].length > 1) { %>
                                    <div class="landscape">
                                        <div class="stl-title">THE LOOK</div>
                                        <div class="stl-look">
                                            <% var  related = obj['tagged-products'] %>
                                            <% for (var i = 0; i < related.length; i++) { %>
                                                <div class="stl-item" data-index="<%- i %>">
                                                    <img src="<%- related[i].images[0].url %>" />
                                                    <div class="name">
                                                        <%- related[i].title || related[i].name %>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <div class="image-without-tagged-products">
                    <div class="table">
                        <div class="row">
                            <div class="middle cell capped-width">
                                <img src="<%= obj.image.url %>" alt="image" class="main-image" />
                            </div>
                            <div class="middle cell">
                                <div class="info">
                                    <div class="title">
                                        Coming soon to Nasty Gal!
                                    </div>
                                    <a class='button' href='http://www.nastygal.com/lookbooks-swim-city' target='_blank'>
                                        <img class="shop-icon" src="{% static 'pinpoint/themes/nastygal/images/shoppingbag.png' %}" />
                                        <div class="inline">
                                            SHOP ON NASTY GAL
                                        </div>
                                    </a>
                                    <div class="social-buttons"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>
        </script>

        <!-- custom templates -->
        <script type="text/template" id="hero_template">
            <div class="hero-image-wrapper">
                <div class="visible-xs jumbotron">
                    <img src="{{ mobile_hero_image }}" alt="Hero" />
                </div>
                <div class="visible-sm jumbotron">
                    <img src="{{ desktop_hero_image }}" alt="Hero" />
                </div>
                <div class="visible-md visible-lg jumbotron"></div>
            </div>
            {% if legal_copy %}
                <div class="legal us">
                    {{ legal_copy }}
                </div>
            {% endif %}
        </script>
    </div>

    <div class="container">
        <!-- .container is bootstrap magic, and has a viewport-dependent width. -->
        <div id="hero-area"></div>
        <div id="category-area"></div>
        <div id="discovery-area" class="discovery-area"></div>
        <div class="no-noscript loading"></div>
        <noscript>
            <!-- promotions to show when user does not have javascript.
             this is a 'we need javascript' message by default.
             -->
            <div class="alert alert-danger">
                <b>Oh no!</b> We need JavaScript enabled to show you this page.
            </div>
        </noscript>
    </div>

    <!-- GAP Google Analytics -->
    <script type="text/javascript">

        function initGapAnalytics () {
            // Shorthand for pushing data to Google Analytics
            var productName = null,
                recordEvent = function (event, eventCategory, eventAction, eventLabel) {
                    dataLayer.push({
                        'event': event,
                        'eventCategory': eventCategory,
                        'eventAction': eventAction,
                        'eventLabel': eventLabel
                    });

                    // for our internal analytics: also track these events.
                    // tracking page_scroll causes infinite loops.
                    if (event !== 'page_scroll' &&
                        window.App &&
                        window.App.vent &&
                        window.App.vent.trigger &&
                        typeof window.App.vent.trigger === 'function') {
                      App.vent.trigger('tracking:trackEvent', {
                          'category': eventCategory,
                          'action': eventAction,
                          'label': eventLabel,
                          'value': event
                      });
                    }
                };

            window._pq = window._pq || [];

            // Tracking Code for GAP's Google Analytics
            window.GAP_ANALYTICS = new App.tracker.EventManager({
                // 1 - Top Nav
                'click a.navbar-brand, .other-brands.dropdown a:not(.dropdown-toggle)': function () {
                    var dataBrand = $(this).data('brand');
                    var brand = "(Unknown)";
                    if (dataBrand && $.trim(dataBrand).length > 0) {
                        brand = dataBrand;
                    } else {
                        var textBrand = $.trim($(this).text().toLowerCase());
                        if (textBrand.length > 0 ) {
                            brand = textBrand;
                        }
                    }

                    recordEvent('gap_nav', 'nav', 'exit', 'nav - ' + brand);
                },
                // 2 - Header Logo
                'click header > a': function () {
                    recordEvent('header_logo', 'header', 'exit', 'gap.com');
                },
                // 3 - Social Subscribe Links
                'click .nav.navbar-nav.navbar-right a, .stay-connected .dropdown-menu a': function () {
                    var social_network = /(?:(\w+?)\.com)/.exec($(this).attr('href'))[1];
                    recordEvent('social_follow', 'follow', social_network + ' follow', 'follow');
                },
                // 4 - Main Visual
                'click #hero-area .jumbotron': function () {
                    recordEvent('main_visual', 'main visual', 'visual click', 'visual click');
                },
                // 5 - Feed Visuals
                'click .tile.product': function () {
                    productName = App.discovery.collection.get($(this).attr('id')).get('name');
                    recordEvent('product_feed', 'product_feed', 'pop-up open', productName);
                },
                // 6 - Product Social Links
                'click .content-wrapper .social-buttons .button': function () {
                    var social_network = $(this).attr('class').replace(/\s*button\s*/, '');
                    recordEvent('product_share', 'product pop-up', social_network + ' share', productName);
                },
                // 7 - Find Product in Store
                'click .content-wrapper a.button.find-store': function () {
                    recordEvent('product_find in store', 'product pop-up', 'find in store', productName);

                    try {
                        _pq.push(['track', 'FindInStore']);
                    } catch(err) {}

                    try {
                        __adroll.record_user({"adroll_segments": 'FindInStore'});
                    } catch(err) {}

                },
                // 8 - Buy Product Online
                'click .content-wrapper a.button.in-store': function () {
                    recordEvent('product_buy online', 'product pop-up', 'buy online', productName);

                    try {
                        _pq.push(['track', 'ShopOnGap']);
                    } catch(err) {}

                    try {
                        __adroll.record_user({"adroll_segments": 'ShopOnGap'});
                    } catch(err) {}

                },
                // 10 - Share deal
                'click #hero-area .buttons a': function () {
                    var social_network = /(?:(\w+?)\.com)/.exec($(this).attr('href'))[1];
                    recordEvent('deal_share', 'header', social_network + ' share', 'share page');
                },
                // 13 - Lifestyle Feed Visuals
                'click .tile.image': function () {
                    var cid = $(this).attr('id'),
                        obj = App.discovery.collection.get(cid),
                        products = obj.get('tagged-products');
                    if (products && products.length > 0) {
                        productName = products[0].name;
                        recordEvent('lifestyle_feed', 'lifestyle feed', 'pop-up open', productName);
                    } else {
                        productName = null;
                    }
                },
                // 14 - Lifestyle Product Social Links
                'click .image-with-tagged-products .social-buttons .button, .image-without-tagged-products .social-buttons .button': function () {
                    if (productName) {
                        var social_network = $(this).attr('class').replace(/\s*button\s*/, '');
                        recordEvent('lifestyle_share', 'lifestyle pop-up', social_network + ' share', productName);
                    }
                },
                // 15 - Find Lifestyle Product in Store
                'click .image-with-tagged-products a.button.find-store, .image-without-tagged-products a.button.find-store': function () {
                    if (productName) {
                        recordEvent('lifestyle_find in store', 'lifestyle pop-up', 'find in store', productName);
                    }
                },
                // 16 - Buy Lifestyle Product Online
                'click .image-with-tagged-products a.button.in-store, .image-without-tagged-products a.button.in-store \
                    .image-with-tagged-products a.buy, .image-without-tagged-products a.buy': function () {
                    if (productName) {
                        recordEvent('lifestyle_buy online', 'lifestyle pop-up', 'buy online', productName);
                    }
                },
                // 17 - Lifestyle Feed Video
                'click .tile.youtube.wide': function () {
                    var cid = $(this).attr('id'),
                        obj = App.discovery.collection.get(cid),
                        products = obj.get('tagged-products');
                    if (products && products.length > 0) {
                        recordEvent('lifestyle_video', 'lifestyle_feed', 'video play', products[0].name);
                    }
                },
                // 18 - Lifestyle Feed Video
                'click #hero-area .overlay .find a': function() {
                    recordEvent('find_store', 'main visual', 'store locator', 'find a store');
                },
                // Perfect Audience
                'click .tile': function() {
                    var cid = $(this).attr('id'),
                        obj = App.discovery.collection.get(cid),
                        page_id, store_slug, feed_id, tile_id;

                    tile_id = obj.get('tile-id');
                    page_id = App.options.page.id;
                    store_slug = App.options.store.slug;

                    // Needs to match the RSS
                    feed_id = store_slug + 'P' + page_id + 'T' + tile_id;

                    try {
                        _pq.push(['track', 'PopUp']);
                        _pq.push(['trackProduct', feed_id]);
                    } catch(err) {}

                    try {
                        __adroll.record_user({"adroll_segments": 'PopUp'});
                        __adroll.record_user({"product_id": feed_id});
                    } catch(err) {}
                }
            });

            // Subscribe to FB event for GAP Analytic tracking
            App.vent.on('tracking:registerFacebookListeners', function () {
                FB.Event.subscribe('edge.create', function(href, widget) {
                    var type = $('div.facebook').eq(0).parents('.image-with-tagged-products, .image-without-tagged-products');
                    if (productName && type && type.length > 0) {
                        recordEvent('lifestyle_share', 'lifestyle pop-up', 'facebook share', productName);
                    } else if (productName) {
                        recordEvent('product_share', 'product pop-up', 'facebook share', productName);
                    }
                });
            });

            var urlParams = App.options.urlParams;
            urlParams += urlParams.length ? "&" : "?";
            switch("{{ url|default:''|escapejs}}") {
                case "livedin":
                    App.options.urlParams = urlParams + "tid=gpme000028";
                    break;
                case "paddingtonbear":
                    App.options.urlParams = urlParams + "tid=gpme000029";
                    break;
                case "presidentsday":
                    App.options.urlParams = urlParams + "tid=gpme000030";
                    break;
            }
        }

        var wait = setInterval(function () {
            if (window.App) {
                clearInterval(wait);
                initGapAnalytics();
            }
        }, 100);
    </script>

    {% if environment == 'production' %}
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NQTT"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NQTT');</script>
    <!-- End Google Tag Manager -->
    {% else %}
    <script type='text/javascript'>
        (function() {
            var dataLayer = window.dataLayer = [];
        }());
    </script>
    {% endif %}

    <!-- Perfect Audience -->
    <script type="text/javascript">
      (function() {
        window._pa = window._pa || {};
        // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
        // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
        // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
        var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
        pa.src = ('https:' === document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/535538ebd9a0e9beae000073.js";
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
      })();
    </script>

    <!-- AdRoll -->
    <script type="text/javascript">
    adroll_adv_id = "7HUSQEXE6ZBQTE6BZ2HE5B";
    adroll_pix_id = "JKZ3HVQNCVGQ7GONAFDN5O";
    (function () {
       __adroll_loaded=true;
       var scr = document.createElement("script");
       var host = (("https:" === document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
       scr.setAttribute('async', 'true');
       scr.type = "text/javascript";
       scr.src = host + "/j/roundtrip.js";
       ((document.getElementsByTagName('head') || [null])[0] ||
        document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    }());
    </script>

    <!-- Dev Only -->
    <script type='text/javascript'>
        (function(){
            window.DEV_FUNCTIONS = {};
            window.DEV_FUNCTIONS.track_me = function() {
                // Track via AdRoll
                try {
                    // Segment must match that of AdRoll
                    __adroll.record_user({"adroll_segments": "developers"});
                } catch(err) {}

                // Track via Perfect Audience
                try {
                    window._pq = window._pq || [];
                    _pq.push(['track', 'developers']);
                } catch(err) {}
            }
        }());
    </script>
    <img src='{% url 'apps.tracking.views.pixel' %}'/>
</body>
</html>

{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% include "pinpoint/campaign_opengraph_tags.html" %}
    {% include "pinpoint/campaign_head.html" %}
    <!-- End Optimizer Tests -->
    <link rel="shortcut icon"
         href="http://canada.roots.com/on/demandware.static/Sites-RootsCA-Site/-/default/v1401786139656/images/favicon.ico" />
    <link rel="stylesheet"
          href="{% static 'pinpoint/themes/roots/roots.css' %}"/>
    {% include "pinpoint/campaign_respond.html" %}
    <!-- Add Optimizer Tests here -->
    <script type="text/javascript">
        window.TRACKING_PIXELS = {
            'A': {
                'view': 'http://cm.gy/ns69',
                'click': 'http://cm.gy/ir6p'
            }
        };
        window.ACTIVE_TEST = 'A';
    </script>
    {% if environment == 'production' %}
        <script type='text/javascript'>
            var interval = setInterval(function() {
                var test, bindFn;

                if (!window.ACTIVE_TEST) {
                    return;
                }

                // Because we need to bind some events before anything else, use this fn
                // http://stackoverflow.com/a/2641047
                $.fn.bindFirst = function(name, fn) {
                    // bind as you normally would
                    // don't want to miss out on any jQuery magic
                    this.on(name, fn);

                    // Thanks to a comment by @Martin, adding support for
                    // namespaced events too.
                    this.each(function() {
                        var handlers = $._data(this, 'events')[name.split('.')[0]];
                        // take out the handler we just inserted from the end
                        var handler = handlers.pop();
                        // move it at the beginning
                        handlers.splice(0, 0, handler);
                    });
                };

                bindFn = function() {
                    (new Image).src = window.TRACKING_PIXELS[test].click;
                }

                clearInterval(interval);
                test = window.ACTIVE_TEST;

                // Append click pixel
                if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    $('.tile').bindFirst('click', bindFn);
                } else {
                    // Why doesn't bindFirst work on desktop?
                    $('body').on('click', '.tile', bindFn);
                }


                // Append page view pixel
                (new Image).src = window.TRACKING_PIXELS[test].view;
            }, 1000);
        </script>
    {% endif %}
    <title>{{ page.name|default:"Roots" }}</title>
    <style type="text/css">
        /* out of necessity */
        .visible-xs.jumbotron { /* mobile hero */
            {% if mobile_hero_image %}
                background-image: url('{{ mobile_hero_image }}');
            {% else %}
                background-image: url('{{ desktop_hero_image }}');
            {% endif %}
        }
        .visible-md.jumbotron, .visible-lg.jumbotron, .visible-sm.jumbotron { /* desktop hero */
            {% if desktop_hero_image %}
                background-image: url('{{ desktop_hero_image }}');
            {% else %}
                background-image: url('{{ mobile_hero_image }}');
            {% endif %}
        }
    </style>
</head>
<body>
    <div class='navbar'>
        <div class="container">
            <div class="line"></div>
            <a href="https://canada.roots.com/" target="_blank">
                <img src="{% static 'pinpoint/themes/roots/images/logo.gif' %}" />
            </a>
        </div>
    </div>

    {% include "pinpoint/campaign_body.html" %}

    <div>
        <!-- generic templates -->
        <script type="text/template" id="category_template">
            <span><%= obj.name %></span>
        </script>

        <script type="text/template" id="shopthelook_template">
            <div class='featured product'>
                <img class='img-responsive pull-left' src='<%= obj.defaultImage.url %>' />
                <div class='pull-right'><%= obj.title || obj.name %></div>
                    <div class='price'><%= obj.price %></div>
                    <div>
                        <a href='<%= obj.url %>' target='_blank'>BUY NOW</a>
                    </div>
                </div>
            </div>

            <div class='spacer'></div>
        </script>

        <script type="text/template" id="product_tile_template">
            <div class="tap-indicator-target"></div>
            <img class="focus" src="<%= obj.image.url %>" alt="<%= caption %>" />
            <% if (App.option('debug', 0) > 1) { %>
                <span class="type"><%= obj['content-type'] %></span>
            <% } %>
            <div class="name"><%= obj.title || obj.name %></div>
            <div class="price">
                <% if (obj.sale_price) { %>
                    <div class="strike inline">
                        <%- obj.price %>
                    </div>
                    <%- obj.sale_price %>
                <% } else { %>
                    <%- obj.price %>
                <% } %>
            </div>
        </script>

        <script type="text/template" id="image_tile_template">
            <div class="tap-indicator-target"></div>
            <div class='relative'>
                <img class="focus" src="<%= obj.image.url %>" alt="<%= obj.caption %>" />
            </div>
            <% if (App.option("debug", 0) > 1) { %>
                <span class="type"><%= obj["content-type"] %></span>
            <% } %>
        </script>

        <script type="text/template" id="youtube_tile_template">
            <div class="img-responsive thumbnail"
                 style="background-image: url('<%= obj.thumbnail || obj.image.url %>');">
              &nbsp;
              <img src="" alt="this img tag intentionally left blank" style="visibility:hidden"/>
            </div>
            <%= obj.caption || obj.name %>
            <div class="social-buttons"></div>
        </script>

        <script type="text/template" id="preview_container_template">
            <div class="fullscreen">
                <div class="content">
                    <span class="close">Back to browsing</span>
                    <div class="roots-logo">
                        <div class="line"></div>
                        <img src="{% static 'pinpoint/themes/roots/images/logo.gif' %}" />
                    </div>
                    <div class="scrollable">
                        <div class="template target"></div>
                    </div>
                </div>
            </div>
            <div class="mask"></div>
        </script>

        <script type="text/template" id="tile_preview_template">
            <h2><span class="label label-info"><%= obj.template %>_preview_template</span> is missing.</h2>
            <p>You can define one in your template.</p>
            <ul>
                <% for (i in obj) { %>
                    <li><b><%= i %></b>: <%= obj[i] %></li>
                <% } %>
            </ul>
        </script>

        <script type="text/template" id="tap_indicator_template">
            +
            <div>
                <%= App.option('tapIndicatorText', 'tap to see more') %>
            </div>
        </script>

        <script type="text/template" id="product_price_template">
            <%- obj.price %>
        </script>

        <script type="text/template" id="product_title_template">
            <%- obj.title || obj.name %>
        </script>

        <script type="text/template" id="product_buy_template">
            <a class='button' href='<%= obj.url %>' target='_blank'>
                Shop Now
            </a>
        </script>

        <script type="text/template" id="product_description_template">
            <%= obj.description %>
        </script>

        <script type="text/template" id="product_galleryMainImage_template">
            <div class="main-image-container">
                <% if (obj.images.length > 1) { %>
                    <div class="gallery-swipe-left"></div>
                    <div class="gallery-swipe-right"></div>
                <% } %>
                <% if (obj.image) { %>
                    <img class="main-image" src='<%= obj.image.url %>'/>
                <% } else { %>
                    <img class="main-image" src='<%= obj.images[0].url %>'/>
                <% } %>
            </div>
        </script>

        <script type="text/template" id="product_preview_template">
            <div class='content-wrapper row'>
                <% if (App.support.mobile()) { %>
                    <div class='cell info'>
                        <div class='title'></div>
                        <div class='price'></div>
                        <div class='buy'></div>
                    </div>
                <% } %>
                <div class='cell'>
                    <div class="gallery-main-image"></div>
                </div>
                <% if (obj.images.length > 1 && App.support.mobile()) { %>
                    <div class='cell'>
                        <div class='gallery dots'></div>
                    </div>
                <% } %>
                <% if (!App.support.mobile()) { %>
                    <div class='cell info'>
                        <div class='title'></div>
                        <div class='price'></div>
                        <div class='buy'></div>
                        <div class="gallery<% if (obj.images.length < 2) { %> hide<% } %>"></div>
                    </div>
                <% } %>
            </div>
        </script>

        <script type="text/template" id="image_preview_template">
            <% if (obj['tagged-products'].length) { %>
                <% var product = obj['tagged-products'][0]; %>
                <div class="image-with-tagged-products">
                    <div class="row">
                        <% if (obj['tagged-products'].length > 1) { %>
                            <div class="cell desktop-only">
                                <div class="stl-title">The Look</div>
                                <div class="stl-look">
                                    <% var  related = obj['tagged-products'] %>
                                    <% for (var i = 0; i < related.length; i++) { %>
                                        <div class="stl-item" data-index="<%- i %>">
                                            <img src="<%- related[i].images[0].url %>" />
                                            <div class="name">
                                                <%- related[i].title || related[i].name %>
                                            </div>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        <% } %>
                        <div class="cell desktop-only">
                            <img src="<%= obj.image.url %>" alt="image" class="image"/>
                        </div>
                        <div class="cell info">
                            <div class='title'></div>
                            <div class='price'></div>
                            <% if (App.support.mobile()) { %>
                                <div class='buy'></div>
                            <% } %>
                            <div class="gallery-main-image"></div>
                            <div class='gallery dots<% if (product.images.length < 2) { %> hide<% } %>'></div>
                            <% if (!App.support.mobile()) { %>
                                <div class='buy'></div>
                            <% } %>
                        </div>
                        <% if (obj['tagged-products'].length > 1 && App.support.mobile()) { %>
                            <div class="more-info">
                                More from this look...
                            </div>
                        <% } %>
                        <div class="cell mobile-only">
                            <img src="<%= obj.image.url %>" alt="image"/>
                        </div>
                        <% if (obj['tagged-products'].length > 1) { %>
                            <div class="cell mobile-only">
                                <div class="stl-title">The Look</div>
                                <div class="stl-look">
                                    <% var related = obj['tagged-products'] %>
                                    <% for (var i = 0; i < related.length; i++) { %>
                                        <div class="stl-item" data-index="<%- i %>">
                                            <img src="<%- related[i].images[0].url %>" />
                                            <div class="name">
                                                <%- related[i].title || related[i].name %>
                                            </div>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
            <% } else { %>
                <div class="image-without-tagged-products">
                    <div class="row">
                        <div class="cell capped-width">
                            <img src="<%= obj.image.url %>" alt="image" class="main-image" />
                        </div>
                        <div class="cell">
                            <div class="info">
                                <div class="title">
                                    Coming soon to Roots!
                                </div>
                                <div class="buy">
                                    <a class='button' href='https://canada.roots.com/' target='_blank'>
                                        Shop On Roots
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>
        </script>

        <!-- custom templates -->
        <script type="text/template" id="hero_template">
            <div class="hero-image-wrapper">
                <div class="visible-xs jumbotron">
                    <img src="{{ mobile_hero_image }}" alt="Hero" />
                </div>
                <div class="visible-sm jumbotron">
                    <img src="{{ desktop_hero_image }}" alt="Hero" />
                </div>
                <div class="visible-md visible-lg jumbotron"></div>
            </div>
            {% if legal_copy %}
                <div class="legal us">
                    {{ legal_copy }}
                </div>
            {% endif %}
        </script>
    </div>

    <div class="container">
        <!-- .container is bootstrap magic, and has a viewport-dependent width. -->
        <div id="hero-area"></div>
        <div id="category-area"></div>
        <div id="discovery-area" class="discovery-area"></div>
        <div class="no-noscript loading"></div>
        <noscript>
            <!-- promotions to show when user does not have javascript.
             this is a 'we need javascript' message by default.
             -->
            <div class="alert alert-danger">
                <b>Oh no!</b> We need JavaScript enabled to show you this page.
            </div>
        </noscript>
    </div>
    <img src='{% url 'apps.tracking.views.pixel' %}'/>
</body>
</html>

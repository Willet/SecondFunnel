{% load staticfiles %}
{% load compress %}
<!-- Head Contents -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">

<!--Begin CSS-->
{% compress css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'pinpoint/css/base.css' %}">
{% endcompress css %}

<!--[if IE 8]>
{% compress css %}
<link rel="stylesheet" type="text/css" href= {% static 'pinpoint/css/ie8.css' %}
{% endcompress css %}
<![endif]-->

<!-- End CSS -->

<!-- Begin Javascript -->

<!-- Preload images -->
<script type="text/javascript">
    {# Preload images #}
    {% if desktop_hero_image %}
        (new Image).src = "{{ desktop_hero_image }}";
    {% endif %}
    {% if mobile_hero_image %}
        (new Image).src = "{{ mobile_hero_image }}";
    {% endif %}
</script>
<!-- End Preload -->

{% include "pinpoint/campaign_config.html" %}

<script type="text/javascript">
    (function() {
        // http://stackoverflow.com/questions/8567114/how-to-make-an-ajax-call-without-jquery
        // Initial call to IR
        /*
        if ((!PAGES_INFO.IRReqNum) || (PAGES_INFO.IRReqNum === undefined)) {
            PAGES_INFO.IRReqNum = 0;
        }

        if (!(PAGES_INFO.initialResults && PAGES_INFO.initialResults.length)) {
            // Support for IE6/5 in the event that XMLHttpRequest doesn't exist
            var xmlhttp, data;
            xmlhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
            xmlhttp.open("GET", "{{ campaign.ir_base_url|default:ir_base_url }}/page/{{ campaign.intentrank_id|default:campaign.id }}/getresults?results=10&algorithm={{ algorithm }}&reqNum=0", true);
            PAGES_INFO.IROffset += 10;
            PAGES_INFO.IRReqNum++;

            xmlhttp.onload = function () {
                // Ensures that it's resolved on 200 or 404
                if (xmlhttp.status === 200) { // success so resolve normally
                    PAGES_INFO.initialResults = JSON.parse(xmlhttp.response || xmlhttp.responseText);
                }
            };
            PAGES_INFO.initialResults = xmlhttp;
            xmlhttp.send();
        }*/
    })();
</script>

{% compress js %}
    {% include "pinpoint/campaign_js.html" %}
{% endcompress %}

<script type="text/javascript">
      var lazyLoad;
      lazyLoad = setInterval(function() {
          if (window.App && document.getElementById('discovery-area')) {
              clearInterval(lazyLoad);
              App.start();
          }
      }, 100);
</script>
<!-- End Javascript -->

<script type="text/javascript" src="//connect.facebook.net/en_US/all.js" async></script>

{% if environment == 'production' or environment == 'test' %}
    {% with 'pinpoint/snippets/raven.js' as ravenJs %}
        <script src="//cdn.ravenjs.com/1.1.11/jquery,native/raven.min.js"></script>
        <script type="text/javascript">
            {% include ravenJs %}
        </script>
    {% endwith %}
{% endif %}

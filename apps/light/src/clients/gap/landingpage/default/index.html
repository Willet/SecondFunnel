<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    @@include('shared/campaign_head.html')
    @@include('shared/campaign_opengraph_tags.html')
    <link rel="shortcut icon"
         href="http://www.gap.com/favicon.ico" />
    <link rel="stylesheet"
          href="/static/light/gap/landingpage/default/styles/main.css"/>
    @@include('shared/campaign_respond.html')
    <!-- Add Optimizer Tests here -->
    <script type="text/javascript">
        window.OPTIMIZER_TESTS = [];
        window.OPTIMIZER_TESTS.push({
            index: 9,
            test: 'custom',
            disabled: true,
            custom: function (cookie) {
                cookie = cookie || _.sample(["A", "B"]);
                if (cookie === "B") {
                    if (App.option('campaign') === "6") {
                        App.options.categoryHome = false;
                        App.options.page.categories = ["women", "girls", "baby (0-24 mos)"];
                    } else {
                        App.options.page.categories = ["men", "women"];
                    }
                }
                return cookie;
            }
        });
        window.OPTIMIZER_TESTS.push({
            index: 10,
            test: 'custom',
            disabled: true,
            custom: function (cookie) {
                cookie = cookie || _.sample(["A", "B"]);
                if (cookie === "B") {
                    App.intentRank.options.IRAlgo = "finite_popular";
                }
                return cookie;
            }
        });
    </script>
    <!-- End Optimizer Tests -->
    <title>{{ page.name|default:"Gap" }}</title>
</head>
<body>
    <div class='header'>
        {% if not campaign.hide_navigation_bar %}
            <div class="navbar navbar-fixed-top navbar-static-top"
                 role="navigation">
                <div id="nav-container" class="container-fluid">
                    <ul class="nav navbar-nav navbar-left">
                        <li>
                            <a data-brand="Gap" class="navbar-brand gap" href="http://www.gap.com" target="_blank">&nbsp;</a>
                            <a data-brand="Old Navy" class="navbar-brand old_navy navbar-brand hidden-xs" href="http://www.oldnavy.com" target="_blank">&nbsp;</a>
                            <a data-brand="Banana Republic" class="navbar-brand banana_republic hidden-xs" href="http://www.bananarepublic.com" target="_blank">&nbsp;</a>
                            <a data-brand="Piperlime" class="navbar-brand piperlime hidden-xs" href="http://www.piperlime.com" target="_blank">&nbsp;</a>
                            <a data-brand="Athleta" class="navbar-brand athleta hidden-xs"  href="http://www.athleta.com" target="_blank">&nbsp;</a>
                        </li>
                        <li class="other-brands dropdown hidden-sm hidden-md hidden-lg">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">&nbsp;</a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                <li>
                                    <a href="http://www.gap.com" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Gap</span>
                                    </a>
                                </li>
                                <li class="old_navy">
                                    <a href="http://oldnavy.com" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Old Navy</span>
                                    </a>
                                </li>
                                <li class="banana_republic">
                                    <a href="http://www.bananarepublic.com" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Banana Republic</span>
                                    </a>
                                </li>
                                <li class="piperlime">
                                    <a href="http://www.piperlime.com" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Piperlime</span>
                                    </a>
                                </li>
                                <li class="athleta">
                                    <a href="http://www.athleta.com" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Athleta</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="stay-connected dropdown hidden-sm hidden-md hidden-lg">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">&nbsp;</a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                <li class="facebook">
                                    <a href="http://www.facebook.com/Gap" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Facebook</span>
                                    </a>
                                </li>
                                <li class="twitter">
                                    <a href="http://www.twitter.com/gap" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Twitter</span>
                                    </a>
                                </li>
                                <li class="pinterest">
                                    <a href="http://www.pinterest.com/Gap" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Pinterest</span>
                                    </a>
                                </li>
                                <li class="instagram">
                                    <a href="http://www.instagram.com/gap" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Instagram</span>
                                    </a>
                                </li>
                                <li class="tumblr">
                                    <a href="http://gap.tumblr.com" target="_blank">
                                        <span class="icon"></span>
                                        <span class="text">Tumblr</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="sharing hidden-xs">
                            Stay Connected:
                            <ul>
                                <li class="icon pinterest">
                                    <a href="http://www.pinterest.com/Gap"
                                       target="_blank">&nbsp;</a>
                                </li>
                                <li class="icon facebook">
                                    <a href="http://www.facebook.com/Gap"
                                       target="_blank">&nbsp;</a>
                                </li>
                                <li class="icon twitter">
                                    <a href="http://www.twitter.com/gap"
                                       target="_blank">&nbsp;</a>
                                </li>
                                <li class="icon instagram">
                                    <a href="http://www.instagram.com/gap"
                                       target="_blank">&nbsp;</a>
                                </li>
                                <li class="icon youtube">
                                    <a href="http://www.youtube.com/Gap"
                                       target="_blank">&nbsp;</a>
                                </li>
                                <li class="icon tumblr">
                                    <a href="http://gap.tumblr.com"
                                       target="_blank">&nbsp;</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
        </div>
    {% endif %}

    @@include('shared/campaign_body.html')

    <div>
        <script type="text/template" id="hero_template">
            <div class="hero-image-wrapper">
                <div class="visible-xs jumbotron">
                    <% if (obj.heroTitle) { %><span class="title"><%= obj.heroTitle %></span><% } %>
                    <img src="<%= obj.mobileHeroImage %>" alt="Hero" />
                </div>
                <div class="hidden-xs jumbotron">
                    <% if (obj.heroTitle) { %><span class="title"><%= obj.heroTitle %></span><% } %>
                    <img src="<%= obj.heroImage %>" alt="Hero" />
                </div>
            </div>
            {% if legal_copy %}
                <div class="legal us">
                    {{ legal_copy }}
                </div>
            {% endif %}
        </script>

        <script type="text/template" id="image_tile_template">
            <div class='relative'>
                <img class="focus" src="<%= obj.images[0].url %>" alt="<%= obj.caption %>" />
                <!-- Varies depending on source (e.g. facebook, styldby, etc) -->
                <div class="overlay">
                    <div class='table'>
                        <div class='cell'>
                            <% /* "Shop product" is actually wanted for the tile overlay */ %>
                            <div class="title">
                                <% var products = obj.taggedProducts ? obj.taggedProducts : []; %>
                                <% if (obj.title || obj.name || obj.caption) { %>
                                    <%= (obj.title || obj.name || obj.caption) %>
                                <% } else if (products.length > 0) { %>
                                    <span>Shop Product<% if (products.length > 1) { %>s<% } %></span>
                                    <br/>
                                    <% _.each(products, function (related) { %>
                                        <span class='shop-products'><%= related.title || related.name || related.caption %></span>
                                    <% }); %>
                                <% } else { %>
                                    Shop Product
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <% if (App.option("debug", 0) > 1) { %>
                <span class="type"><%= obj["content-type"] %></span>
            <% } %>
        </script>

        <script type="text/template" id="hypem_tile_template">
            <iframe src="/static/light/gap/landingpage/default/media_player/player.html" height="789" width="100%" scrolling="no" style="border:none;"></iframe>
        </script>

        <script type="text/template" id="preview_container_template">
            <div class="fullscreen">
                <div class="content">
                    <span class="close desktop-only">X</span>
                    <span class="close mobile-only">Back</span>
                    <div class="scrollable">
                        <div class="template target"></div>
                    </div>
                </div>
            </div>
            <div class="mask"></div>
        </script>

        <script type="text/template" id="product_price_template">
            <div class="price-wrapper <% if (obj.salePrice) { %>sale<% } %>">
                <% if (obj.salePrice) { %>
                    <% if (App.support.mobile()) { %>
                        <%- obj.salePrice %>
                        <div class="strike">
                            <%- obj.price %>
                        </div>
                    <% } else { %>
                        <div class="strike inline">
                            <%- obj.price %>
                        </div>
                        <%- obj.salePrice %>
                    <% } %>
                <% } else { %>
                    <%- obj.price %>
                <% } %>
            </div>
        </script>

        <script type="text/template" id="product_buy_template">
            <a class="button find-store desktop-only" href='http://www.gap.com/customerService/storeLocator.do' target='_blank'>Find a store</a>
            <a class="button find-store mobile-only" href='http://m.gap.com/storelocator.html' target='_blank'>Find a store</a>
            <a class='button in-store desktop-only' href='<%- obj.url %>' target='_blank'>
                Shop on Gap.com
            </a>
            <a class='button in-store mobile-only' href='<%- obj.url %>' target='_blank'>
                Shop Now
            </a>
        </script>

        <script type="text/template" id="product_description_template">
            <div class='desc-title'>Overview</div>
            <% var description = (obj.description || ""); %>
            <% if (!description.match(/<li(?:.|\n)*?>/)) { %>
                <% var sentences = _.compact(description.split('.')); %>
                <ul>
                    <% _.each(sentences, function(sentence) { %>
                        <li><%= App.utils.safeString(sentence) %></li>
                    <% }); %>
                </ul>
            <% } else { %>
                <%= App.utils.safeString(description) %>
            <% } %>
        </script>

        <script type="text/template" id="product_preview_template">
            <div class="product-info table"></div>
        </script>

        <!-- custom templates -->
        <script type="text/template" id="desktop_tagged_products">
            <% if (obj.taggedProducts.length > 1 && obj.orientation === 'portrait') { %>
                <div class="cell desktop-only shop">
                    <div class="stl-title">
                        Shop the Look
                    </div>
                    <div class="stl-look">
                        <% var related = obj.taggedProducts; %>
                        <% for (var i = 0; i < related.length; i++) { %>
                            <div class="stl-item" data-index="<%- i %>">
                                <img src="<%- related[i].images[0].url %>" />
                                <%- related[i].name %>
                            </div>
                        <% } %>
                    </div>
                </div>
            <% } %>
            <div class="cell desktop-only">
                <img src="<%= image_src %>" alt="image" class="image look-image"/>
                <% if (obj.taggedProducts.length > 1 && obj.orientation === 'landscape') { %>
                    <% if (obj.taggedProducts.length > 1) { %>
                        <div class="landscape">
                            <div class="stl-title">Shop the Look</div>
                            <div class="stl-look">
                                <% var  related = obj.taggedProducts; %>
                                <% for (var i = 0; i < related.length; i++) { %>
                                    <div class="stl-item" data-index="<%- i %>">
                                        <img src="<%- related[i].images[0].url %>" />
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    <% } %>
                <% } %>
            </div>
            <div class="cell info">
                <div class="product-info"></div>
            </div>
        </script>

        <script type="text/template" id="mobile_tagged_products">
            <div class="cell">
                <img src="<%= image_src %>" alt="image" class="image look-image"/>
            </div>
            <div class="cell info">
                <div class="product-info"></div>
            </div>
            <div class="cell mobile-only">
                <% if (obj.taggedProducts.length > 1) { %>
                    <div class="landscape">
                        <div class="stl-title">Shop the Look</div>
                        <div class="stl-look">
                            <% var  related = obj.taggedProducts; %>
                            <% for (var i = 0; i < related.length; i++) { %>
                                <div class="stl-item" data-index="<%- i %>">
                                    <img src="<%- related[i].images[0].url %>" />
                                </div>
                            <% } %>
                        </div>
                    </div>
                <% } %>
            </div>
        </script>

        <script type="text/template" id="no_tagged_products">
            <div class="image cell desktop-only">
                <img class="image" src="<%= image_src %>" alt="image" class="image look-image"/>
            </div>
            <div class="cell info">
                <div class='title'><%= obj.title || obj.name || "Coming soon to Gap!" %></div>
                <div class="buy desktop-only">
                    <a class="button" href="http://gap.com/" target="_blank">
                        Shop on Gap.com
                    </a>
                    <a class="button find-store"
                       href="http://www.gap.com/customerService/storeLocator.do"
                       target="_blank">
                        Find a Store
                    </a>
                </div>
                <div class='description desktop-only'>
                    <%= App.utils.safeString(obj.caption || obj.description) %>
                </div>
            </div>
                <div class="image cell mobile-only">
                    <img class="image" src="<%= image_src %>" alt="image"/>
                </div>
                <div class="buy mobile-only">
                    <a class="button" href="http://m.gap.com/" target="_blank">
                        Shop on Gap.com
                    </a>
                    <a class="button find-store"
                       href="http://m.gap.com/storelocator.html"
                       target="_blank">
                        Find a Store
                    </a>
                </div>
        </script>

        <script type="text/template" id="image_info_template">
            <div class="tagged-product">
                <div class='title'>
                    <% include("product_title_template") %>
                </div>
                <div class='price'>
                    <% include("product_price_template") %>
                </div>
            <% if (App.support.mobile()) { %>
                <div class="relative">
                    <div class="gallery-main-image">
                        <% include("product_galleryMainImage_template") %>
                    </div>
                    <div class='gallery-dots<% if (obj.images.length < 2) { %> hide<% } %>'>
                        <div>
                            <% include("product_galleryDots_template") %>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <div class="gallery-main-image">
                    <% include("product_galleryMainImage_template") %>
                </div>
                <div class='gallery-dots<% if (obj.images.length < 2) { %> hide<% } %>'>
                    <% include("product_galleryDots_template") %>
                </div>
            <% } %>
                <div class='buy'>
                    <% include("product_buy_template") %>
                </div>
            </div>
        </script>

        <script type="text/template" id="product_info_template">
            <div class="tagged-product row">
                <div class='cell info mobile-only'>
                    <div class='title'>
                        <% include("product_title_template") %>
                    </div>
                    <div class='price'>
                        <% include("product_price_template") %>
                    </div>
                </div>
                <div class='cell'>
                <% if (App.support.mobile()) { %>
                    <div class='relative'>
                        <div class="gallery-main-image">
                            <% include("product_galleryMainImage_template") %>
                        </div>
                        <div class='gallery-dots<% if (obj.images.length < 2) { %> hide<% } %>'>
                            <% include("product_galleryDots_template") %>
                        </div>
                    </div>
                    <div class='buy'>
                        <% include("product_buy_template") %>
                    </div>
                <% } else { %>
                    <div class="gallery-main-image">
                        <% include("product_galleryMainImage_template") %>
                    </div>
                <% } %>
                </div>
                <div class='cell info desktop-only'>
                    <div>
                        <div class='title'>
                            <% include("product_title_template") %>
                        </div>
                        <div class='price'>
                            <% include("product_buy_template") %>
                        </div>
                    </div>
                    <div class='description'>
                        <% include("product_description_template") %>
                    </div>
                    <div class='buy'>
                        <% include("product_buy_template") %>
                    </div>
                    <div class="gallery<% if (obj.images.length < 2) { %> hide<% } %>">
                        <% include("product_gallery_template") %>
                    </div>
                </div>
            </div>
        </script>

        <script type="text/template" id="hero_template">
            <% var heroId = 1 + Math.floor(Math.random() * 3); %>
            <% var isDressNormal = (App.option('page:slug') === 'dressnormal'); %>
            <div class="hero-image-wrapper">
                <div class="visible-xs jumbotron">
                    <% if (isDressNormal) { %>
                        <img src="https://s3.amazonaws.com/elasticbeanstalk-us-east-1-056265713214/images/<%= heroId %>mobilehero.png" alt="Hero" />
                    <% } else { %>
                        <img src="{{ mobile_hero_image }}" alt="Hero" />
                    <% } %>
                </div>
                <div class="visible-sm visible-lg visible-md jumbotron">
                    <% if (isDressNormal) { %>
                        <img src="https://s3.amazonaws.com/elasticbeanstalk-us-east-1-056265713214/images/<%= heroId %>desktophero.png" alt="Hero" />
                    <% } else { %>
                        <img src="{{ desktop_hero_image }}" alt="Hero" />
                    <% } %>
                </div>
                <div class="overlay <%- App.option('overlayButtonColor') %> <% if ( App.option('overlayMobileButtonColor')) { %>mobile-<%- App.option('overlayMobileButtonColor') %><% } %>">
                    <span class='find'>
                        <% if (!App.support.mobile()) { %>
                            <a href='http://www.gap.com/customerService/storeLocator.do' target='_blank'>Find a store</a>
                        <% } else { %>
                            <a href='http://m.gap.com/storelocator.html' target='_blank'>Find a store</a>
                        <% } %>
                    </span>
                    <div class='buttons'>
                        <%
                            var share = App.option("page.description", "");
                            var src = top.location.href;
                            var fbLink = 'http://www.facebook.com/sharer/sharer.php?'
                                + 's=100'
                                + '&p[title]=Gap'
                                + '&p[summary]=' + share.replace(' ', '+')
                                + '&p[url]=' + encodeURIComponent(src)
                                + '&p[images][0]={{ desktop_hero_image }}';

                            var twtLink = 'http://twitter.com/share?'
                                + 'url=' + encodeURIComponent(src)
                                + '&text=' + encodeURIComponent(share);

                            var mailLink = 'mailto:?'
                                + 'body=' + encodeURIComponent(share);
                        %>
                        <a href='<%= fbLink %>' target='_blank' class="facebook-button"></a>
                        <a href='<%= twtLink %>' target='_blank' class="twitter-button"></a>
                        <a href='<%= mailLink %>' target='_blank' class="email-button"></a>
                    </div>
                </div>
            </div>
            {% if legal_copy %}
                <div class="legal us">
                    {{ legal_copy }}
                </div>
            {% endif %}
        </script>
    </div>

    <div id="main" class="container-fluid">
        <!-- .container is bootstrap magic, and has a viewport-dependent width. -->
        <div id="hero-area"></div>
        <div id="category-area"></div>
        <div id="discovery-area" class="discovery-area"></div>
        <div class="tile-sizer tile"></div>
        <div class="no-noscript loading"></div>
        <noscript>
            <!-- promotions to show when user does not have javascript.
             this is a 'we need javascript' message by default.
             -->
            <div class="alert alert-danger">
                <b>Oh no!</b> We need JavaScript enabled to show you this page.
            </div>
        </noscript>
    </div>

    <!-- GAP Google Analytics -->
    <script type="text/javascript">

        function initGapAnalytics () {
            // Shorthand for pushing data to Google Analytics
            var productName = null,
                recordEvent = function (event, eventCategory, eventAction, eventLabel) {
                    dataLayer.push({
                        'event': event,
                        'eventCategory': eventCategory,
                        'eventAction': eventAction,
                        'eventLabel': eventLabel
                    });

                    // for our internal analytics: also track these events.
                    // tracking page_scroll causes infinite loops.
                    if (event !== 'page_scroll' &&
                        window.App &&
                        window.App.vent &&
                        window.App.vent.trigger &&
                        typeof window.App.vent.trigger === 'function') {
                      App.vent.trigger('tracking:trackEvent', {
                          'category': eventCategory,
                          'action': eventAction,
                          'label': eventLabel,
                          'value': event
                      });
                    }
                };

            window._pq = window._pq || [];

            // Tracking Code for GAP's Google Analytics
            window.GAP_ANALYTICS = new App.tracker.EventManager({
                // 1 - Top Nav
                'click a.navbar-brand, .other-brands.dropdown a:not(.dropdown-toggle)': function () {
                    var dataBrand = $(this).data('brand');
                    var brand = "(Unknown)";
                    if (dataBrand && $.trim(dataBrand).length > 0) {
                        brand = dataBrand;
                    } else {
                        var textBrand = $.trim($(this).text().toLowerCase());
                        if (textBrand.length > 0 ) {
                            brand = textBrand;
                        }
                    }

                    recordEvent('gap_nav', 'nav', 'exit', 'nav - ' + brand);
                },
                // 2 - Header Logo
                'click header > a': function () {
                    recordEvent('header_logo', 'header', 'exit', 'gap.com');
                },
                // 3 - Social Subscribe Links
                'click .nav.navbar-nav.navbar-right a, .stay-connected .dropdown-menu a': function () {
                    var social_network = /(?:(\w+?)\.com)/.exec($(this).attr('href'))[1];
                    recordEvent('social_follow', 'follow', social_network + ' follow', 'follow');
                },
                // 4 - Main Visual
                'click #hero-area .jumbotron': function () {
                    recordEvent('main_visual', 'main visual', 'visual click', 'visual click');
                },
                // 5 - Feed Visuals
                'click .tile.product': function () {
                    productName = App.discovery.collection.get($(this).attr('id')).get('name');
                    recordEvent('product_feed', 'product_feed', 'pop-up open', productName);
                },
                // 6 - Product Social Links
                'click .content-wrapper .social-buttons .button': function () {
                    var social_network = $(this).attr('class').replace(/\s*button\s*/, '');
                    recordEvent('product_share', 'product pop-up', social_network + ' share', productName);
                },
                // 7 - Find Product in Store
                'click .content-wrapper a.button.find-store': function () {
                    recordEvent('product_find in store', 'product pop-up', 'find in store', productName);

                    try {
                        _pq.push(['track', 'FindInStore']);
                    } catch(err) {}

                    try {
                        __adroll.record_user({"adroll_segments": 'FindInStore'});
                    } catch(err) {}

                },
                // 8 - Buy Product Online
                'click .content-wrapper a.button.in-store': function () {
                    recordEvent('product_buy online', 'product pop-up', 'buy online', productName);

                    try {
                        _pq.push(['track', 'ShopOnGap']);
                    } catch(err) {}

                    try {
                        __adroll.record_user({"adroll_segments": 'ShopOnGap'});
                    } catch(err) {}

                },
                // 10 - Share deal
                'click #hero-area .buttons a': function () {
                    var social_network = /(?:(\w+?)\.com)/.exec($(this).attr('href'))[1];
                    recordEvent('deal_share', 'header', social_network + ' share', 'share page');
                },
                // 13 - Lifestyle Feed Visuals
                'click .tile.image': function () {
                    var cid = $(this).attr('id'),
                        obj = App.discovery.collection.get(cid),
                        products = obj.get('taggedProducts');
                    if (products && products.length > 0) {
                        productName = products[0].name;
                        recordEvent('lifestyle_feed', 'lifestyle feed', 'pop-up open', productName);
                    } else {
                        productName = null;
                    }
                },
                // 14 - Lifestyle Product Social Links
                'click .image-with-tagged-products .social-buttons .button, .image-without-tagged-products .social-buttons .button': function () {
                    if (productName) {
                        var social_network = $(this).attr('class').replace(/\s*button\s*/, '');
                        recordEvent('lifestyle_share', 'lifestyle pop-up', social_network + ' share', productName);
                    }
                },
                // 15 - Find Lifestyle Product in Store
                'click .image-with-tagged-products a.button.find-store, .image-without-tagged-products a.button.find-store': function () {
                    if (productName) {
                        recordEvent('lifestyle_find in store', 'lifestyle pop-up', 'find in store', productName);
                    }
                },
                // 16 - Buy Lifestyle Product Online
                'click .image-with-tagged-products a.button.in-store, .image-without-tagged-products a.button.in-store \
                    .image-with-tagged-products a.buy, .image-without-tagged-products a.buy': function () {
                    if (productName) {
                        recordEvent('lifestyle_buy online', 'lifestyle pop-up', 'buy online', productName);
                    }
                },
                // 17 - Lifestyle Feed Video
                'click .tile.youtube.wide': function () {
                    var cid = $(this).attr('id'),
                        obj = App.discovery.collection.get(cid),
                        products = obj.get('taggedProducts');
                    if (products && products.length > 0) {
                        recordEvent('lifestyle_video', 'lifestyle_feed', 'video play', products[0].name);
                    }
                },
                // 18 - Lifestyle Feed Video
                'click #hero-area .overlay .find a': function() {
                    recordEvent('find_store', 'main visual', 'store locator', 'find a store');
                },
                // Perfect Audience
                'click .tile.image, .tile.product': function() {
                    var cid = $(this).attr('id'),
                        obj = App.discovery.collection.get(cid),
                        product, pageId, storeSlug, feedId,
                        segment, analyticsTile, analyticsProduct, related,
                        analyticsPage, tileId;

                    tileId = obj.get('tile-id');
                    pageId = App.options.page.id;
                    storeSlug = App.options.store.slug;

                    // Needs to match the RSS
                    feedId = storeSlug + 'P' + pageId + 'T' + tileId;

                    if ($(this).hasClass('image')) {
                        segment = 'ImagePopUp';
                    } else if ($(this).hasClass('product')) {
                        segment = 'ProductPopUp';
                    }

                    try {
                        _pq.push(['track', segment]);
                        _pq.push(['track', 'PopUp']);
                        _pq.push(['trackProduct', feedId]);
                    } catch(err) {}
                }
            });

            // Scroll event has to be seperately tracked.
            // 12 - Scroll for more
            var pagesScrolled = 1;
            App.vent.on('tracking:trackEvent', function (o) {
                if (o.action === 'scroll') {
                    recordEvent('page_scroll', 'scroll', 'page_scroll', 'scroll - ' + o.label);
                }
            });

            // Subscribe to FB event for GAP Analytic tracking
            App.vent.on('tracking:registerFacebookListeners', function () {
                FB.Event.subscribe('edge.create', function(href, widget) {
                    var type = $('div.facebook').eq(0).parents('.image-with-tagged-products, .image-without-tagged-products');
                    if (productName && type && type.length > 0) {
                        recordEvent('lifestyle_share', 'lifestyle pop-up', 'facebook share', productName);
                    } else if (productName) {
                        recordEvent('product_share', 'product pop-up', 'facebook share', productName);
                    }
                });
            });

            switch("{{ campaign.url_slug|default:''|escapejs}}") {
                case "livedin":
                    App.options.page.urlParams.tid = "gpme000028";
                    break;
                case "paddingtonbear":
                    App.options.page.urlParams.tid = "gpme000029";
                    break;
                case "presidentsday":
                    App.options.page.urlParams.tid = "gpme000030";
                    break;
            }
        }

        var wait = setInterval(function () {
            if (window.App) {
                clearInterval(wait);
                initGapAnalytics();
            }
        }, 100);
    </script>

    {% if environment == 'production' %}
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NQTT"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NQTT');</script>
    <!-- End Google Tag Manager -->
    {% else %}
    <script type='text/javascript'>
        (function() {
            var dataLayer = window.dataLayer = [];
        }());
    </script>
    {% endif %}

    <!-- Perfect Audience -->
    <script type="text/javascript">
      (function() {
        window._pa = window._pa || {};
        // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
        // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
        // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
        var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
        pa.src = ('https:' === document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/52fd209b01a11d23fd000004.js";
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
      })();
    </script>

    <!-- AdRoll -->
    <script type="text/javascript">
    adroll_adv_id = "JQVBFPLBNNH7TNXQAS2ZT2";
    adroll_pix_id = "JJ7XDEWBKJBZTD2MESDLGL";
    (function () {
       __adroll_loaded=true;
       var scr = document.createElement("script");
       var host = (("https:" === document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
       scr.setAttribute('async', 'true');
       scr.type = "text/javascript";
       scr.src = host + "/j/roundtrip.js";
       ((document.getElementsByTagName('head') || [null])[0] ||
        document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    }());
    </script>

    <!-- Dev Only -->
    <script type='text/javascript'>
        (function(){
            window.DEV_FUNCTIONS = {};
            window.DEV_FUNCTIONS.track_me = function() {
                // Track via AdRoll
                try {
                    // Segment must match that of AdRoll
                    __adroll.record_user({"adroll_segments": "developers"});
                } catch(err) {}

                // Track via Perfect Audience
                try {
                    window._pq = window._pq || [];
                    _pq.push(['track', 'developers']);
                } catch(err) {}
            }
        }());
    </script>
    <img src="{% url 'apps.tracking.views.pixel' %}"/>
    <div>
        @@include('shared/default_templates.html')
    </div>
    <script type="text/javascript" src="/static/light/gap/landingpage/default/scripts/main.js" async></script>
</body>
</html>

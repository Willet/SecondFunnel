<!-- Head Contents -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">

<!-- Begin Javascript -->

<!-- Preload images -->
<script type="text/javascript">
    {% if desktop_hero_image %}
        (new Image).src = "{{ desktop_hero_image }}";
    {% endif %}
    {% if mobile_hero_image %}
        (new Image).src = "{{ mobile_hero_image }}";
    {% endif %}
</script>
<!-- End Preload -->

@@include('shared/campaign_config.html')

<script type="text/javascript">
    (function() {
        // http://stackoverflow.com/questions/8567114/how-to-make-an-ajax-call-without-jquery
        // Initial call to IR
        if ((!PAGES_INFO.IRReqNum) || (PAGES_INFO.IRReqNum === undefined)) {
            PAGES_INFO.IRReqNum = 0;
        }

        if (!(PAGES_INFO.initialResults && PAGES_INFO.initialResults.length)) {
            // Support for IE6/5 in the event that XMLHttpRequest doesn't exist
            var xmlhttp, data;
            xmlhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
            xmlhttp.open("GET", "{{ campaign.ir_base_url|default:ir_base_url }}/page/{{ campaign.intentrank_id|default:campaign.id }}/getresults?results=10&algorithm={{ algorithm }}&reqNum=0", true);
            PAGES_INFO.IROffset += 10;
            PAGES_INFO.IRReqNum++;

            xmlhttp.onload = function () {
                // Ensures that it's resolved on 200 or 404
                if (xmlhttp.status === 200) { // success so resolve normally
                    PAGES_INFO.initialResults = JSON.parse(xmlhttp.response || xmlhttp.responseText);
                }
            };
            PAGES_INFO.initialResults = xmlhttp;
            xmlhttp.send();
        }
    })();
</script>

@@include('shared/campaign_js.html')

<!-- End Javascript -->

<script type="text/javascript" src="//connect.facebook.net/en_US/all.js" async></script>

{% if environment == 'production' or environment == 'test' %}
    {% with 'shared/snippets/raven.js' as ravenJs %}
        <script src="//cdn.ravenjs.com/1.1.11/jquery,native/raven.min.js"></script>
        <script type="text/javascript">
            {% include ravenJs %}
        </script>
    {% endwith %}
{% endif %}

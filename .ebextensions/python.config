packages:
  yum:
    libxslt: []
    libxslt-devel: []
    libxml2: []
    libxml2-devel: []

commands:
 01_syncdb:
  command: "./manage.py syncdb --noinput"
  leader_only: true
 02_createadmin:
  command: "scripts/createadmin.py"
  leader_only: true
 03_collectstatic:
  command: "./manage.py collectstatic --noinput"
 04_migrate_schema:
  command: "./manage.py migrate --noinput"
  leader_only: true
 05_rubygems_install:
  command: "yum install -y rubygems"
 06_bundler_install:
  command: "gem install bundler"
 07_install_gems:
  command: "bundle install --deployment"
 08_append_ssh_keys:
  command: "cat ./ssh_keys > /home/ec2-user/.ssh/authorized_keys"
 06_setup_celery:
  command: "scripts/celeryd_link.sh"
  leader_only: true
 07_run_celery_beat:
  command: "/etc/init.d/celerybeat stop && /etc/init.d/celerybeat start"
  leader_only: true
 08_run_celery_worker:
  command: "/etc/init.d/celeryd stop && /etc/init.d/celeryd start"
  leader_only: true

option_settings:
  - namespace: "aws:elasticbeanstalk:container:python:environment"
    option_name:  DJANGO_SETTINGS_MODULE
    value: "secondfunnel.settings.production"
  - option_name:  ProductionBucket
    value: elasticbeanstalk-us-east-1-056265713214
  - option_name:  ProductionCache
    value:  cache-test.yz4kz2.0001.usw2.cache.amazonaws.com:11211
  - namespace:  "aws:elasticbeanstalk:container:python"
    option_name:  WSGIPath
    value:  secondfunnel/wsgi.py
  - namespace:  "aws:elasticbeanstalk:container:python:staticfiles"
    option_name:  /static/
    value:  static/
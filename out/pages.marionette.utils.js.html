<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages.marionette.utils.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: pages.marionette.utils.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*global SecondFunnel, Backbone, Marionette, console, broadcast */
/**
 * @module utils
 */
SecondFunnel.module("utils", function (utils, SecondFunnel) {
    "use strict";

    var $document = $(document),
        $window = $(window),
        regions = {},
        regionWidgets = {};

    /**
     * Cleans obviously invalid UI strings.
     *
     * @param {string} str
     * @param {undefined} opts
     * @returns {string}
     */
    this.safeString = function (str, opts) {
        var regex =/^(None|undefined|[Ff]alse|0)$/,
            trimmed = $.trim(str);
        if (regex.test(trimmed)) {
            return trimmed.replace(regex, '');
        }
        return str;
    };

    /**
     * Does minimal URL checking (stackoverflow.com/a/1305082/1558430)
     *
     * @param {string} url
     * @returns {bool}
     */
    this.isURL = function (url) {
        return (typeof url === 'string' && url.length > 2 &&
            url.indexOf('//') >= 0);
    };

    /**
     * add a predefined UI component implemented as a region.
     * @param {string} name of the widget.
     *                 name must be unique.
     *                 if registerWidget is called with an existing
     *                  widget, the old one is overwritten.
     *
     * @param {string} selector a jquery selector,
     * @param {function} functionality the widget function.
     * @returns true
     */
    this.registerWidget = function (name, selector, functionality) {
        regions[name] = selector;
        regionWidgets[name] = functionality;
        broadcast('widgetRegistered', name, selector, functionality,
            regions, regionWidgets);
        return true;  // success
    };

    /**
     * allows designers to add a custom (tile) class.
     * if class name is already taken, the original class is overwritten.
     *
     * @param {string} name
     * @param {object} defn
     * @returns defn
     */
    this.addClass = function (name, defn) {
        SecondFunnel.core[_.capitalize(name)] = defn;
        broadcast('classAdded', name, defn);
        return defn;
    };

    /**
     * returns a class in the window scope and app core,
     *  or defaultClass if nothing else is found.
     * This is also known as patching.
     *
     * @param {string} typeName e.g. 'Tile', 'TileView'
     * @param {string} prefix e.g. 'Video'
     * @param {object} defaultClass e.g. TileView
     * @returns {object}|defaultClass
     */
    this.findClass = function (typeName, prefix, defaultClass) {
        var FoundClass,
            targetClassName = _.capitalize(prefix || '') +
                              _.capitalize(typeName || '');
        if (SecondFunnel.core[targetClassName] !== undefined) {
            // if designers want to define a new tile view, they must
            // let SecondFunnel know of its existence.
            FoundClass = SecondFunnel.core[targetClassName];
        } else {
            FoundClass = defaultClass;
        }

        console.debug('findClass(%s, %s, %O) -> %O', typeName, prefix,
            defaultClass, FoundClass);

        return FoundClass;
    };

    /**
     * process widget regions.
     * each widget function receives args (the view, the $element, option alias).
     * TODO: tests
     *
     * @param {View} viewObject
     */
    this.runWidgets = function (viewObject) {
        var self = viewObject;

        // process itself (if it is a view)
        _.each(regions, function (selector, name, list) {
            var widgetFunc = regionWidgets[name];
            self.$(selector).each(function (idx, el) {
                return widgetFunc(self, $(el), SecondFunnel.option);
            });
        });

        // process children regions (if it is a layout)
        _.each(self.regions, function (selector, name, list) {
            var isWidget = _.contains(regions, name),
                widgetFunc = (regionWidgets || {})[name];
            if (isWidget && widgetFunc) {
                self.$(selector).each(function (idx, el) {
                    return widgetFunc(self, $(el), SecondFunnel.option);
                });
            }
        });
    };

    /**
     * returns a url that is either
     *    - the url, if it is not an image service url, or
     *    - an image url pointing to one that is at least as wide as
     *      minWidth, or
     *    - an image url pointing to one that is at most as wide as
     *      the window width, or
     *    - if minWidth is ridiculously large, master.jpg.
     * if scalePolicy is "max", then the image served is always smaller
     *    than requested.
     *
     * @param {string} url
     * @param {int} minWidth
     * @param {min|max|undefined} scalePolicy
     * @returns {string}
     */
    this.pickImageSize = function (url, minWidth, scalePolicy) {
        var i,
            prevKey = 'pico',
            maxLogicalSize = Math.min($window.width(), $window.height()),
            // TODO: URL spec not found in /Willet/planning/blob/master/architecture/specifications/image-service.md
            sizable = /images\.secondfunnel\.com.+\.(jpe?g|png)/.test(url),
            nameRegex = /([^/]+)\.(jpe?g|png)/,
            imageSizes = SecondFunnel.option('imageSizes', {
                // see Scraper: ImageServiceIntegrationTest.java#L52
                "pico": 16,
                "icon": 32,
                "thumb": 50,
                "small": 100,
                "compact": 160,
                "medium": 240,
                "large": 480,
                "grande": 600,
                "1024x1024": 1024,
                "master": 2048
            });

        if (!utils.isURL(url)) {
            throw "First parameter must be a valid URL";
        }

        if (!sizable) {
            return url;
        }

        // TODO: a better idea
        for (i in imageSizes) {
            if (imageSizes.hasOwnProperty(i)) {
                if (!scalePolicy || scalePolicy === 'min') {
                    if (imageSizes[i] >= minWidth) {
                        return url.replace(nameRegex, i + '.$2');
                    }
                } else if (scalePolicy === 'max') {
                    if (imageSizes[i] >= minWidth) {
                        return url.replace(nameRegex, prevKey + '.$2');
                    }
                }
                if (imageSizes[i] >= maxLogicalSize) {
                    return url.replace(nameRegex, prevKey + '.$2');
                }
            }
            prevKey = i;
        }
        return url;
    };
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-core.html">core</a></li><li><a href="module-intentRank.html">intentRank</a></li><li><a href="module-layoutEngine.html">layoutEngine</a></li><li><a href="module-sharing.html">sharing</a></li><li><a href="module-support.html">support</a></li><li><a href="module-tracker.html">tracker</a></li><li><a href="module-utils.html">utils</a></li><li><a href="module-viewport.html">viewport</a></li></ul><h3>Classes</h3><ul><li><a href="module-core-core.Discovery.html">Discovery</a></li><li><a href="module-core-core.HeroAreaView.html">HeroAreaView</a></li><li><a href="module-core-core.TileCollection.html">TileCollection</a></li><li><a href="module-core-core.TileView.html">TileView</a></li><li><a href="module-core-core.VideoTileView.html">VideoTileView</a></li><li><a href="sharing.FacebookSocialButton.html">FacebookSocialButton</a></li><li><a href="sharing.ShareOption.html">ShareOption</a></li><li><a href="sharing.SharePopup.html">SharePopup</a></li><li><a href="sharing.ShareSocialButton.html">ShareSocialButton</a></li><li><a href="sharing.SocialButton.html">SocialButton</a></li><li><a href="sharing.SocialButtons.html">SocialButtons</a></li><li><a href="sharing.TwitterSocialButton.html">TwitterSocialButton</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_exists">_exists</a></li><li><a href="global.html#debugOp">debugOp</a></li><li><a href="global.html#option">option</a></li><li><a href="global.html#receive">receive</a></li><li><a href="global.html#reInitialize">reInitialize</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Wed Sep 25 2013 18:03:33 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
